<!DOCTYPE html>
<html lang="cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,minimum-scale=1,user-scalable=no">
  <link href="../css/html-font-color.css" rel="stylesheet">
  <link href="../css/component.css" rel="stylesheet">
  <link href="../css/fooddetial.css" rel="stylesheet">
  <title>someFood</title>


</head>

<body>
  <header>
    <div id="backButton">
      <img class="imgWithRatio" src="../images/arrow-black.png" alt="箭头" onclick="history.back(-1)">
      <!-- 注意这个img有一个onclick处理器,就是用来回到上一个界面 -->
    </div>

    <div id="likeButton">
      <img id="blackheart" class="imgWithRatio" src="../images/heart-black.png" alt="表示不喜欢的黑心">
      <img id="redheart" class="imgWithRatio" src="../images/heart-red.png" alt="表示喜欢的红心">
    </div>
  </header>

  <div class="detailImg"></div>

  <div id="nameAndStar"></div>

  <div id="docuBar" class="background-red"></div>

  <div id="GoToRightDown"></div>


  <script src="../javascript/common.js"></script>
  <script src="../javascript/fooddetail.js"></script>
  <script src="../javascript/addOrderToCart.js"></script>
  <script src="../javascript/generFoodInfo.js"></script>

  <script>
    //基础页面(没啥东西)加载完成,就向服务器请求这个食物的数据
    var querystring = window.location.href.split("?")[1].split('=');
    var XHR = new XMLHttpRequest();

    XHR.onreadystatechange = function () {
      if (XHR.readyState === 4 && XHR.status === 200) {
        generFoodDetail(JSON.parse(XHR.responseText));
      }
    }
    XHR.open('get', `/foodDetailContent?id=${querystring[1]}`, true);
    XHR.send();

    //生成页面
    function generFoodDetail(responseJSON) {
      console.log(responseJSON);

      //大图片
      generPic(responseJSON.pic, '', ".imgContainer, .detailImg");

      //食物名称和星星
      generNameAndStar(responseJSON.point, responseJSON.name, 'class="foodTitle"', 'class="starGroup"', '#nameAndStar');

      //装饰条应该不用动态生成.

      //↓生成详细信息
      var detailInfoStr = `<h5 class="detail gray">${responseJSON.descript}</h5>`

      //↓ 生成表格
      var forminnerHTML = '';

      for (select in responseJSON.selection) {
        console.log(select);
        //对每一个选项,生成title和boxgroup
        var titleStr = `<h4>${select}</h4>`;
        var boxsGroupStr = generOneBoxGroup(select, responseJSON.selection[select], false);
        forminnerHTML += titleStr + boxsGroupStr;
      }

      forminnerHTML += '<input type="submit" class="bigButton white background-red redButton" value="Add to Cart">';


      //生成表格元素,向其中添加内容
      var formouterHTML = `<form action="/addtocart" method="POST">${forminnerHTML}</form>`;
      document.querySelector('#GoToRightDown').innerHTML = detailInfoStr + formouterHTML;

      document.querySelectorAll('.outerBox:first-of-type>input').forEach(function (input) {
        input.setAttribute('checked', 'checked');
      })

      //要放在这个生成函数中,因为生成函数是一个回调函数
      addHandlerToButton('input[type="submit"]', 'form', '.foodTitle');
    }
  </script>
</body>

</html>