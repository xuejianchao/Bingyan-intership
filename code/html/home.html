<!DOCTYPE html>
<html lang="cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,minimum-scale=1,user-scalable=no">
  <link href="../css/html-font-color.css" rel="stylesheet">
  <link href="../css/component.css" rel="stylesheet">
  <link href="../css/home.css" rel="stylesheet">
  <link href="../css/fooditem.css" rel="stylesheet">

  <title>主页</title>


</head>

<body>

  <section id="deliAndRecoSection">
    <section id="deliverySec">
      <div id="deLiMan-warp">
        <div class="imgContainer">
          <img src="../images/th(1).png">
        </div>
      </div>

      <!-- <div style="display:inline-block; vertical-align: middle"> -->
      <div>
        <div id="deliLable">
          <img class="imgWithRatio" src="../images/address.png">
        </div>
        <h6 class="red" style="display: inline-block">
          DELIVERY
        </h6>
      </div>
      <h3 id="cityInfo">Bangalore, India</h3>

    </section>

    <section id="recoSectionTitleGroup">
      <h4 class="viewAll"><a href="/recommend" class="red">view all</a></h4>
      <h1 class="headTitle">Recommend</h1>
      <h5 class="gray">Based on your purchase history</h5>
    </section>

    <section id="recommendCard">
      <a href="/foodDetailPage"></a>
      <div id="starAndNameCon"></div>
      <form action="/addToCart"></form>

      <div id="docurateBox"></div>
    </section>
  </section>

  <section id="menuSection">
    <section id="menuSectionTitleGroup">
      <h4 class="viewAll"><a href="/menu" class="red">view all</a></h4>
      <h1 class="headTitle">Menu</h1>
      <h5 class="gray">What's on our menu</h5>
    </section>

    <section class="menuGridContainer">
    </section>
  </section>


  <script src="../javascript/common.js"></script>
  <script src="../javascript/getfoodItems.js"></script>
  <script src="../javascript/addOrderToCart.js"></script>
  <script src="../javascript/generFoodInfo.js"></script>

  <script>
    //从后台请求食品的数据,然后添加到页面中
    var XHR = new XMLHttpRequest();
    XHR.onreadystatechange = function () {
      if (XHR.readyState === 4 && XHR.status === 200) {
        generAllMoudle(JSON.parse(XHR.responseText), '.menuGridContainer');
      }
    }
    XHR.open('get', '/menu/getmenu', true);
    XHR.send();


    //获取第一个推荐食品
    var XHRforReco = new XMLHttpRequest();
    XHRforReco.onreadystatechange = function () {
      if (XHRforReco.readyState === 4 && XHRforReco.status === 200) {
        generRecoCard(JSON.parse(XHRforReco.responseText));
      }
    }
    XHRforReco.open('get', '/getFirstReco', true);
    XHRforReco.send();

    function generRecoCard(contentObject) {
      //动态添加图片
      generPic(contentObject.pic, 'id="recommendImg"', 'a[href="/foodDetailPage"]');
      //动态添加star&title
      generNameAndStar(contentObject.point, contentObject.name, 'id="recFoorTitle"', 'class="starGroup"', "#starAndNameCon");

      //获取所有的selection的boxgroupStr,并且设置后两个display:none
      var allBoxGroupStr = '';
      for (select in contentObject.selection) {
        if(select === 'Size'){
          allBoxGroupStr += generOneBoxGroup(select,contentObject.selection[select],false);
        } else{
          allBoxGroupStr += generOneBoxGroup(select,contentObject.selection[select],true);
        }
      }

      //将两个按钮连接到boxgroupStr后面,
      var forminnerHtml = allBoxGroupStr + 
        `<a href="/foodDetailPage?id=${contentObject.id}">
          <p class="bigButton black background-lightGray">Customize & Add</p>
        </a>
        <input type="submit" class="bigButton white background-red redButton" value="Add to Cart">`

      //将forminnerHtml放入form中
      document.querySelector('form[action="/addToCart"]').innerHTML = forminnerHtml;

      document.querySelectorAll('.outerBox:first-of-type>input').forEach(function (input) {
        input.setAttribute('checked', 'checked');
      });

      addHandlerToButton('input[type="submit"]', 'form[action="/addToCart"]', "#recFoorTitle");
    }
  </script>
</body>

</html>